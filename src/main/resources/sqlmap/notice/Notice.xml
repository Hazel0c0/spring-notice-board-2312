<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="NoticeService">

    <select id="getPostList" parameterType="java.util.Map" resultType="java.util.HashMap">
        SELECT ROWNUM
        ,POST_SQNO
        ,POST_TIT
        ,CASE WHEN MAIN_VW_POP_MK_YN = '1' THEN 'Y' ELSE '' END AS MAIN_VW_POP_MK_YN_YN
        ,ATTFL_ID_YN
        ,REG_DTM
        ,MOD_DTM
        ,(SELECT EMP_NM FROM TB_SB_CM_EMP WHERE ENO = A.REGMN_ID) AS EMP_NM
        ,SCH_NT
        ,( SELECT Z.DISABLED_1DAY
        FROM TB_SB_CM_SCH_DAY Z
        WHERE Z.ENO = #{ENO}
        AND Z.BIZ_DSC = 'NTC'
        AND Z.POST_SQNO = A.POST_SQNO ) AS DISABLED_1DAY
        FROM
        (
        SELECT POST_SQNO,
        POST_TIT,
        CASE WHEN ATTFL_ID IS NULL THEN 'N' ELSE 'Y' END AS ATTFL_ID_YN,
        REG_DTM,
        MOD_DTM,
        MAIN_VW_POP_MK_YN,
        REGMN_ID,
        SCH_NT
        FROM TB_SB_OT_BORD_J A
        WHERE 1=1
        AND POST_TP_DSC = '1'
        AND DEL_YN = '0'
        <if test="REG_ST_DT != '' and REG_ST_DT != null">
            AND SUBSTR(A.REG_DTM,1,6) BETWEEN #{REG_ST_DT} AND #{REG_ED_DT}
        </if>
        <if test="POST_TIT != '' and POST_TIT != null">
            AND UPPER(POST_TIT) LIKE UPPER('%'||#{POST_TIT}||'%')
        </if>
        <if test="REGMN_ID != '' and REGMN_ID != null">
            AND (
            REGMN_ID LIKE '%' || #{REGMN_ID} || '%'
            OR
            REGMN_ID IN (
            SELECT ENO
            FROM TB_SB_CM_EMP
            WHERE EMP_NM LIKE '%' || #{REGMN_ID} || '%'
            )
            )
        </if>
        ORDER BY POST_SQNO DESC
        ) A
        <if test="rownum != null and rownum!=''">
            WHERE rownum <![CDATA[ <=]]>#{rownum}
        </if>
    </select>

    <insert id="insertPost" parameterType="java.util.Map">
        INSERT INTO TB_SB_OT_BORD_J (
        POST_TP_DSC,
        POST_SQNO,
        CO_CD,
        POST_TIT,
        POST_CNTN,
        MAIN_VW_POP_MK_YN,
        <if test="ATTFL_ID != '' and ATTFL_ID != null">
            ATTFL_ID,
        </if>
        DEL_YN,
        SCH_NT,
        REGMN_ID,
        REG_DTM
        ) VALUES (
        '1',
        (SELECT (CASE WHEN MAX(POST_SQNO) IS NULL THEN 0 ELSE MAX(POST_SQNO) END)+1 FROM TB_SB_OT_BORD_J
        WHERE POST_TP_DSC = '1'),
        '',
        #{POST_TIT},
        #{POST_CNTN},
        #{MAIN_VW_POP_MK_YN},
        <if test="ATTFL_ID != '' and ATTFL_ID != null">
            #{ATTFL_ID},
        </if>
        '0',
        0,
        #{REGMN_ID},
        TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
        )
    </insert>

</mapper>
